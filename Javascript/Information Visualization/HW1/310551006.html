<!DOCTYPE html>
<meta charset="utf-8" />

<!-- http://a2885360d7a4cd20.vis.lab.djosix.com:2020 -->
<!-- Load d3.js -->
<script src="https://d3js.org/d3.v6.js"></script>

<body>
	<!-- Initialize a select button -->
	<label>X-axis</label
	><select id="selectButton_X"></select>
	<!-- Initialize a select button -->
	<label>Y-axis</label
	><select id="selectButton_Y"></select>
	<!-- Create a div where the graph will take place -->
	<div id="my_dataviz"></div>
</body>

<!-- scatter plot -->
<script>
	// set the dimensions and margins of the graph
	const margin = { top: 10, right: 30, bottom: 40, left: 60 },
		width = 1000 - margin.left - margin.right,
		height = 1000 - margin.top - margin.bottom;

	// append the svg object to the body of the page
	const svg = d3
		.select("#my_dataviz")
		.append("svg")
		.attr("width", width + margin.left + margin.right)
		.attr("height", height + margin.top + margin.bottom)
		.append("g")
		.attr("transform", `translate(${margin.left}, ${margin.top})`);

	// Add the grey background that makes ggplot2 famous
	svg
		.append("rect")
		.attr("x", 0)
		.attr("y", 0)
		.attr("height", height)
		.attr("width", height)
		.style("fill", "EBEBEB");

	//Read the data
	d3.csv("http://vis.lab.djosix.com:2020/data/iris.csv").then(function (data) {
		var columns = [
			"sepal length",
			"sepal width",
			"petal length",
			"petal width",
			"class",
		];

		// add the options to the X-axis button
		d3.select("#selectButton_X")
			.selectAll("myOptions")
			.data(columns)
			.enter()
			.append("option")
			.text(function (d) {
				return d;
			}) // text showed in the menu
			.attr("value", function (d) {
				return d;
			}); // corresponding value returned by the button

		// add the options to the Y-axis button
		d3.select("#selectButton_Y")
			.selectAll("myOptions")
			.data(columns)
			.enter()
			.append("option")
			.text(function (d) {
				return d;
			}) // text showed in the menu
			.attr("value", function (d) {
				return d;
			}); // corresponding value returned by the button

		// find x-axis min and max
		var xMin = d3.min(data, function (d) {
			return d["sepal length"];
		});
		var xMax = d3.max(data, function (d) {
			return d["sepal length"];
		});
		// Add X axis
		var x = d3.scaleLinear().domain([xMin, xMax]).range([0, width]);
		//X-axis tick(white)
		var xAxis = svg
			.append("g")
			.attr("transform", "translate(0," + height + ")")
			.call(
				d3
					.axisBottom(x)
					.tickSize(-height * 1.3)
					.ticks(10)
			)
            xAxis
			.select(".domain")
			.remove();

		// find y-axis min and max
		var yMin = d3.min(data, function (d) {
			return d["sepal width"];
		});
		var yMax = d3.max(data, function (d) {
			return d["sepal width"];
		});
		// Add Y axis
		var y = d3.scaleLinear().domain([yMin, yMax]).range([height, 0]);
		var yAxis = svg //Y-axis tick(white)
			.append("g")
			.call(
				d3
					.axisLeft(y)
					.tickSize(-width * 1.3)
					.ticks(7)
			)
            yAxis
			.select(".domain")
			.remove();

		// Customization
		svg.selectAll(".tick line").attr("stroke", "white");

		// Add X axis label:
		var XAxisLabel = svg
			.append("text")
			.attr("text-anchor", "end")
			.attr("x", width / 2 + margin.left)
			.attr("y", height + margin.top + 20)
			.text("Sepal Length");

		// Y axis label:
		var YAxisLabel = svg
			.append("text")
			.attr("text-anchor", "end")
			.attr("transform", "rotate(-90)")
			.attr("y", -margin.left + 20)
			.attr("x", -margin.top - height / 2 + 20)
			.text("Sepal width");

		// Color scale: give me a specie name, I return a color
		var color = d3
			.scaleOrdinal()
			.domain(["Iris-setosa", "Iris-versicolor", "Iris-virginica"])
			.range(["#F8766D", "#00BA38", "#619CFF"]);
		// Add dots
		var scatter = svg
			.append("g")
			.selectAll("dot")
			.data(data)
			.join("circle")
			.attr("cx", function (d) {
				return x(d["sepal length"]);
			})
			.attr("cy", function (d) {
				return y(d["sepal width"]);
			})
			.attr("r", 5)
			.style("fill", function (d) {
				return color(d.class);
			});

		// A function that update the chart
		function update(XAxisName, YAxisName) {
			// Create new data with the selection?
			var dataFilter = data.map(function (d) {
				return { x: d[XAxisName], y: d[YAxisName], class: d["class"]};
			});


			// find x-axis min and max
			var xMin = d3.min(dataFilter, function (d) {
				return d.x;
			});
			var xMax = d3.max(dataFilter, function (d) {
				return d.x;
			});
			// Update X axis
			x.domain([xMin, xMax]);
			xAxis.transition().duration(1000).call(d3.axisBottom(x).tickSize(-height * 1.3).ticks(10));

            // find x-axis min and max
			var yMin = d3.min(dataFilter, function (d) {
				return d.y;
			});
			var yMax = d3.max(dataFilter, function (d) {
				return d.y;
			});
			// Update X axis
			y.domain([yMin, yMax]);
			yAxis.transition().duration(1000).call(d3.axisLeft(y).tickSize(-width * 1.3).ticks(7));
		    svg.selectAll(".tick line").attr("stroke", "white");
            xAxis
			.select(".domain")
			.remove();
            yAxis
			.select(".domain")
			.remove();
            

			// Give these new data to update line
			svg
				.selectAll("circle")
                .data(dataFilter)
                .transition()
                .duration(1000)
				.attr("cx", function (d) {
					// console.log(d)
					return x(d.x);
				})
				.attr("cy", function (d) {
					return y(d.y);
				})
				.attr("r", 5)
				.style("fill", function (d) {
					return color(d.class);
				});

			//update axis label
			XAxisLabel.text(XAxisName);
			YAxisLabel.text(YAxisName);
			console.log(svg);
		}

		// When the x-axis button is changed, run the updateChart function
		d3.select("#selectButton_X").on("change", function (d) {
			// recover the option that has been chosen
			var XAxisName = d3.select(this).property("value");
			var YAxisName = d3.select("#selectButton_Y").property("value");
			// run the updateChart function with this selected option
			update(XAxisName, YAxisName);
		});

		// When the y-axis button is changed, run the updateChart function
		d3.select("#selectButton_Y").on("change", function (d) {
			// recover the option that has been chosen
			var XAxisName = d3.select("#selectButton_X").property("value");
			var YAxisName = d3.select(this).property("value");
			// run the updateChart function with this selected option
			update(XAxisName, YAxisName);
		});
	});
</script>


